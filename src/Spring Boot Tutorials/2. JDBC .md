

## Spring JDBC Module

### What is JDBC?

**JDBC (Java Database Connectivity)** is a Java API that enables Java applications to interact with databases.

**Analogy**: Think of JDBC as a **universal translator** between your Java application and any database. Just like a translator helps you communicate in different languages, JDBC helps your Java code "speak" to MySQL, PostgreSQL, Oracle, etc.

### Memory Visualization

```
┌─────────────────────────────────────┐
│     Java Application                │
│  ┌──────────────────────────┐       │
│  │  Your Business Logic     │       │
│  └───────────┬──────────────┘       │
│              │                       │
│  ┌───────────▼──────────────┐       │
│  │    JDBC Template         │       │
│  │  (Spring Abstraction)    │       │
│  └───────────┬──────────────┘       │
│              │                       │
│  ┌───────────▼──────────────┐       │
│  │    DataSource            │       │
│  │  (Connection Pool)       │       │
│  └───────────┬──────────────┘       │
└──────────────┼──────────────────────┘
               │
    ┌──────────▼──────────┐
    │     Database        │
    │   (MySQL/Oracle)    │
    └─────────────────────┘
```

----------

### JdbcTemplate

**What is JdbcTemplate?** Spring's JdbcTemplate eliminates boilerplate JDBC code (opening connections, handling exceptions, closing resources).

**Analogy**: Traditional JDBC is like **cooking from scratch** every time (buying ingredients, preparing, cooking, cleaning). JdbcTemplate is like having a **smart kitchen assistant** that handles all the prep and cleanup—you just focus on the recipe.

**Without JdbcTemplate (Traditional JDBC):**

java

```java
Connection conn = null;
PreparedStatement ps = null;
ResultSet rs = null;
try {
    conn = dataSource.getConnection();
    ps = conn.prepareStatement("SELECT * FROM users WHERE id = ?");
    ps.setInt(1, userId);
    rs = ps.executeQuery();
    while(rs.next()) {
        // process results
    }
} catch(SQLException e) {
    // handle exception
} finally {
    if(rs != null) rs.close();
    if(ps != null) ps.close();
    if(conn != null) conn.close();
}
```

**With JdbcTemplate:**

java

```java
@Repository
public class UserRepository {
    
    @Autowired
    private JdbcTemplate jdbcTemplate;
    
    public User findById(int id) {
        String sql = "SELECT * FROM users WHERE id = ?";
        return jdbcTemplate.queryForObject(sql, new UserRowMapper(), id);
    }
    
    public List<User> findAll() {
        String sql = "SELECT * FROM users";
        return jdbcTemplate.query(sql, new UserRowMapper());
    }
    
    public int save(User user) {
        String sql = "INSERT INTO users(name, email) VALUES(?, ?)";
        return jdbcTemplate.update(sql, user.getName(), user.getEmail());
    }
}
```

----------

### DataSource

**What is DataSource?** A DataSource is a **factory for database connections**. It manages connection pooling for better performance.

**Analogy**: Think of DataSource as a **taxi stand**. Instead of calling a new taxi every time (expensive and slow), you have a pool of taxis waiting. When you need one, you grab it, use it, and return it to the pool.

**Memory Visualization:**

```
DataSource (Connection Pool)
┌─────────────────────────────────┐
│  ┌────┐ ┌────┐ ┌────┐ ┌────┐   │
│  │Con1│ │Con2│ │Con3│ │Con4│   │  <- Available Connections
│  └────┘ └────┘ └────┘ └────┘   │
│  ┌────┐ ┌────┐                  │
│  │Con5│ │Con6│  (In Use)        │  <- Currently borrowed
│  └────┘ └────┘                  │
└─────────────────────────────────┘
Max Pool Size: 10 connections
```

**SpringBoot Configuration:**

properties

```properties
# application.properties
spring.datasource.url=jdbc:mysql://localhost:3306/mydb
spring.datasource.username=root
spring.datasource.password=password
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# Connection Pool Settings
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000
```

----------

### RowMapper

**What is RowMapper?** RowMapper is an interface that **converts database rows to Java objects**.

**Analogy**: RowMapper is like a **translator** who reads a foreign document (database row) and tells you the information in your language (Java object).

java

```java
public class UserRowMapper implements RowMapper<User> {
    
    @Override
    public User mapRow(ResultSet rs, int rowNum) throws SQLException {
        User user = new User();
        user.setId(rs.getInt("id"));
        user.setName(rs.getString("name"));
        user.setEmail(rs.getString("email"));
        user.setAge(rs.getInt("age"));
        return user;
    }
}
```

**Visual Flow:**

```
Database Row                    RowMapper                   Java Object
┌─────────────┐                                          ┌──────────────┐
│ id: 1       │                                          │ User {       │
│ name: John  │  ──────▶  mapRow() method  ──────▶     │   id: 1      │
│ email: j@e  │           (Translation)                 │   name: John │
│ age: 25     │                                          │   email: j@e │
└─────────────┘                                          │   age: 25    │
                                                         └──────────────┘
```

----------

### Complete SpringBoot JDBC Example

**Project Structure:**

```
src/
├── main/
│   ├── java/
│   │   └── com/example/
│   │       ├── Application.java
│   │       ├── model/
│   │       │   └── User.java
│   │       ├── repository/
│   │       │   └── UserRepository.java
│   │       ├── mapper/
│   │       │   └── UserRowMapper.java
│   │       └── service/
│   │           └── UserService.java
│   └── resources/
│       └── application.properties
```

**User.java (Model):**

java

```java
public class User {
    private Integer id;
    private String name;
    private String email;
    private Integer age;
    
    // Constructors
    public User() {}
    
    public User(String name, String email, Integer age) {
        this.name = name;
        this.email = email;
        this.age = age;
    }
    
    // Getters and Setters
    // toString() method
}
```

**UserRepository.java:**

java

```java
@Repository
public class UserRepository {
    
    @Autowired
    private JdbcTemplate jdbcTemplate;
    
    // Create
    public int save(User user) {
        String sql = "INSERT INTO users(name, email, age) VALUES(?, ?, ?)";
        return jdbcTemplate.update(sql, 
            user.getName(), 
            user.getEmail(), 
            user.getAge());
    }
    
    // Read - Single User
    public User findById(int id) {
        String sql = "SELECT * FROM users WHERE id = ?";
        return jdbcTemplate.queryForObject(sql, new UserRowMapper(), id);
    }
    
    // Read - All Users
    public List<User> findAll() {
        String sql = "SELECT * FROM users";
        return jdbcTemplate.query(sql, new UserRowMapper());
    }
    
    // Update
    public int update(User user) {
        String sql = "UPDATE users SET name=?, email=?, age=? WHERE id=?";
        return jdbcTemplate.update(sql, 
            user.getName(), 
            user.getEmail(), 
            user.getAge(),
            user.getId());
    }
    
    // Delete
    public int deleteById(int id) {
        String sql = "DELETE FROM users WHERE id = ?";
        return jdbcTemplate.update(sql, id);
    }
    
    // Count
    public int count() {
        String sql = "SELECT COUNT(*) FROM users";
        return jdbcTemplate.queryForObject(sql, Integer.class);
    }
}
```

----------

## JPA & Spring Data JPA

### What is JPA?

**JPA (Java Persistence API)** is a **specification** (not implementation) that defines how Java objects should be persisted to relational databases.

**Analogy**: JPA is like a **recipe book** (specification). Hibernate, EclipseLink are the **chefs** (implementations) who follow the recipe.

```
┌─────────────────────────────────┐
│         JPA (Specification)     │
│      "The Rules/Contract"       │
└────────────┬────────────────────┘
             │
    ┌────────┼────────┐
    │        │        │
┌───▼───┐ ┌──▼──┐ ┌──▼─────┐
│Hiber- │ │Eclip│ │OpenJPA │
│nate   │ │seLnk│ │        │
└───────┘ └─────┘ └────────┘
(Implementations)
```

### What is ORM?

**ORM (Object-Relational Mapping)** bridges the gap between object-oriented programming and relational databases.

**Analogy**: ORM is like a **diplomat** who translates between two different cultures:

-   **Java World**: Objects, Classes, Inheritance
-   **Database World**: Tables, Rows, Foreign Keys

**The Impedance Mismatch Problem:**

```
Java World                          Database World
┌──────────────┐                   ┌──────────────────┐
│ User Object  │                   │  users TABLE     │
│ ────────────│                   │ ────────────────│
│ - id         │  ◄─── ORM ───►   │ | id | name |   │
│ - name       │     (Maps)        │ | 1  | John |   │
│ - orders[]   │                   │ | 2  | Jane |   │
│   (List)     │                   │ └──────────────┘ │
└──────────────┘                   │                  │
                                    │  orders TABLE    │
                                    │ ────────────────│
                                    │ | id | user_id |│
                                    │ | 10 |    1    |│
                                    └──────────────────┘
```

**Without ORM:**

java

```java
// Manual SQL and mapping
String sql = "SELECT * FROM users WHERE id = ?";
ResultSet rs = statement.executeQuery(sql);
User user = new User();
user.setId(rs.getInt("id"));
user.setName(rs.getString("name"));
// ... more boilerplate
```

**With ORM (JPA):**

java

```java
// Just use objects!
User user = entityManager.find(User.class, 1);
```

----------

### What is Persistence Layer?

The **Persistence Layer** is responsible for storing and retrieving data.

**Architecture Layers:**

```
┌──────────────────────────────────────┐
│     Presentation Layer               │
│     (Controllers/REST APIs)          │
└────────────┬─────────────────────────┘
             │
┌────────────▼─────────────────────────┐
│     Service Layer                    │
│     (Business Logic)                 │
└────────────┬─────────────────────────┘
             │
┌────────────▼─────────────────────────┐
│     Persistence Layer ★              │
│     (Data Access - JPA/Hibernate)    │
└────────────┬─────────────────────────┘
             │
┌────────────▼─────────────────────────┐
│         Database                     │
│     (MySQL, PostgreSQL, etc.)        │
└──────────────────────────────────────┘
```

**Analogy**: The persistence layer is like a **librarian**:

-   You (service layer) ask for a book (data)
-   The librarian knows where to find it (database queries)
-   Returns the book to you (object mapping)
-   You don't need to know the library's organization system

----------

### Entity Class & JPA Annotations

**What is an Entity?** An Entity is a **Java class that maps to a database table**.

**Complete Example:**

java

```java
@Entity
@Table(name = "users")
public class User {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    @Column(name = "id")
    private Long id;
    
    @Column(name = "name", nullable = false, length = 100)
    private String name;
    
    @Column(name = "email", unique = true, nullable = false)
    private String email;
    
    @Column(name = "age")
    private Integer age;
    
    @Column(name = "created_date")
    @Temporal(TemporalType.TIMESTAMP)
    private Date createdDate;
    
    @OneToMany(mappedBy = "user", cascade = CascadeType.ALL)
    private List<Order> orders = new ArrayList<>();
    
    // Constructors
    public User() {}
    
    public User(String name, String email, Integer age) {
        this.name = name;
        this.email = email;
        this.age = age;
        this.createdDate = new Date();
    }
    
    // Getters and Setters
}
```

**Annotation Breakdown:**
<img width="800" height="368" alt="image" src="https://github.com/user-attachments/assets/20d95748-a5cb-4032-8147-d15fd03955a3" />
**Memory Visualization:**

```
Java Object (In Memory)          Database Table (On Disk)
┌─────────────────────┐          ┌──────────────────────────┐
│ User {              │          │ users TABLE              │
│   id: 1             │  ◄────►  │ ┌────┬──────┬─────────┐ │
│   name: "John"      │  Maps    │ │ id │ name │  email  │ │
│   email: "j@e.com"  │          │ ├────┼──────┼─────────┤ │
│   age: 25           │          │ │ 1  │ John │ j@e.com │ │
│ }                   │          │ │ 2  │ Jane │ ja@e.cm │ │
└─────────────────────┘          │ └────┴──────┴─────────┘ │
                                 └──────────────────────────┘
```

----------
